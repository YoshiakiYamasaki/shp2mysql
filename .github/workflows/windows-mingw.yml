name: "Windows MinGW"

on:
  - push

jobs:
  build:
    runs-on: windows-latest
    env:
      MSYSTEM: MINGW64
      MSYS2_ARCH: x86_64
    steps:
    - uses: actions/checkout@v1
    - name: Install MSYS2
      run: |
        choco install --no-progress msys2 --params="/NoUpdate /NoPath"
    - name: Update MSYS2
      run: |
        $env:PATH = "C:\tools\msys64\usr\bin;C:\Windows\system32;C:\Windows;C:\Windows\System32\Wbem"
        C:\tools\msys64\usr\bin\pacman --noconfirm -Syyuu
        C:\tools\msys64\usr\bin\pacman --noconfirm -Syuu
    - name: Install Dependencies
        $env:PATH = "C:\tools\msys64\usr\bin;C:\Windows\system32;C:\Windows;C:\Windows\System32\Wbem"
      run: C:\tools\msys64\usr\bin\pacman --noconfirm -S base-devel mingw-w64-i686-toolchain mingw-w64-x86_64-toolchain
    - name: Autogen
      run: |
        $env:PATH = "C:\Windows\system32;C:\Windows;C:\Windows\System32\Wbem"
        C:\tools\msys64\usr\bin\bash -lc "./autogen.sh"
      env:
        CHERE_INVOKING: yes
    - name: Configure
      run: |
        $env:PATH = "C:\Windows\system32;C:\Windows;C:\Windows\System32\Wbem"
        C:\tools\msys64\usr\bin\bash -lc "./configure"
      env:
        CHERE_INVOKING: yes
    - name: Make
      run: |
        $env:PATH = "C:\Windows\system32;C:\Windows;C:\Windows\System32\Wbem"
        C:\tools\msys64\usr\bin\bash -lc "make dist"
      env:
        CHERE_INVOKING: yes
#    - uses: actions/upload-artifact@masterwith:
#      name: 
#      path: 
